---
import { db, desc, eq, Guestbook as GuestbookDB, isNull, or } from "astro:db";

import Notecard from "../Notecard/Notecard.astro";

const LIMIT = 8;

const guestbook = await db
  .select()
  .from(GuestbookDB)
  .where(or(eq(GuestbookDB.isSpam, false), isNull(GuestbookDB.isSpam)))
  .orderBy(desc(GuestbookDB.timestamp))
  .limit(LIMIT);
---

<ul class="guestbook-feed">
  {
    guestbook.map(({ author, url, content, timestamp, theme }) => (
      <li>
        <Notecard
          author={author}
          url={url}
          content={content}
          timestamp={timestamp}
          theme={theme}
          small
        />
      </li>
    ))
  }
</ul>

<style>
  .guestbook-feed {
    list-style: none;
    display: flex;
    gap: var(--space-m);
    padding-inline: var(--space-xl);
    padding-block: var(--space-2xs) var(--space-l);
    margin: 0;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-padding: var(--space-xl);
    scrollbar-width: thin;

    li {
      display: inline-block;
      padding: 0;
      flex-shrink: 0;
      scroll-snap-align: start;
    }
  }
</style>

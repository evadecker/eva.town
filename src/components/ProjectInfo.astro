---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";

import { Icon } from "./Icon/Icon";
import ProjectInfoBlock from "./ProjectInfoBlock.astro";

interface Props {
  project: CollectionEntry<"projects">;
}

const { project } = Astro.props;
const { timeline, roles, collaborators, tech, website, repo } = project.data;
---

<dl class="project-info">
  {timeline && <ProjectInfoBlock title="Timeline">{timeline}</ProjectInfoBlock>}
  {
    roles && (
      <ProjectInfoBlock title="My Role">
        <ul>
          {roles.map((role) => (
            <li>{role}</li>
          ))}
        </ul>
      </ProjectInfoBlock>
    )
  }
  {
    collaborators && (
      <ProjectInfoBlock title="Collaborators">
        <ul>
          {collaborators.map((collaborator) =>
            // Condense whitespace
            // prettier-ignore
            <li><a class="collaborator" href={collaborator.url} target="_blank"><Image src={collaborator.img} alt={`A photo of ${collaborator.name}`} class="avatar" />{collaborator.name}</a></li>
          )}
        </ul>
      </ProjectInfoBlock>
    )
  }
  {
    tech && (
      <ProjectInfoBlock title="Tech">
        <ul>
          {tech.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </ProjectInfoBlock>
    )
  }
  {
    website && (
      <ProjectInfoBlock title="Website">
        <ul>
          <li>
            <a href={website} target="_blank">
              {website}
            </a>
          </li>
        </ul>
      </ProjectInfoBlock>
    )
  }
  {
    repo && (
      <ProjectInfoBlock title="Source">
        <ul>
          <li>
            <a href={`https://github.com/${repo}`} target="_blank">
              View on Github
            </a>
          </li>
        </ul>
      </ProjectInfoBlock>
    )
  }
</dl>

<style lang="scss">
  .project-info {
    display: flex;
    flex-direction: column;
    border: 1px solid var(--gray-5);
    border-radius: var(--radius-m);
    padding: var(--space-l);
    gap: var(--space-m);

    ul,
    li {
      all: unset;
    }

    ul {
      display: flex;
      flex-wrap: wrap;
      column-gap: var(--space-2xs);
    }

    li:not(:last-child)::after {
      content: ",";
      color: var(--gray-11);
    }
  }

  :global(.transitioning) .project-info {
    transition: border-color 0.2s ease-in-out;
  }

  .collaborator {
    display: inline;
    padding-left: calc(var(--space-l) + var(--space-2xs));
    position: relative;
  }

  .avatar {
    background: var(--gray-4);
    width: var(--space-l);
    height: var(--space-l);
    border-radius: var(--radius-full);
    line-height: 0;
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
  }
</style>
